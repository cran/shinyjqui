shinyjqui=function(){var getInputContainer=function(e){if(!$(e).hasClass("shiny-bound-input"))return e;if($(e).hasClass("btn"))return e;var t=$(e).closest(".shiny-input-container");return t.length?t.get(0):e},regShinyInput=function(e,t,a){$.each(a,function(a,n){var i=t+"_"+a;$.each(n,function(t,a){$(e).on(t,function(e,t){var n=a(e,t);Shiny.onInputChange(i,n)})})})},handleShinyInput=function(e,t,a){var n=shinyjqui.getId(e);if(n){var i=Object.assign({},a);if(t&&t.hasOwnProperty("shiny")){var r=Object.keys(i);$.each(r,function(e,a){$.inArray(a.replace(/:.+/,""),Object.keys(t.shiny))>=0&&delete i[a]}),$.extend(i,t.shiny),delete t.shiny}regShinyInput(e,n,i)}},evaluateJSExpressions=function(opt,idx){$.each(idx,function(key,value){!0===value&&opt[key]?opt[key]=eval("("+opt[key]+")"):"object"==typeof value&&evaluateJSExpressions(opt[key],value)})},evalJS=function(e){var t=e._js_idx;return t&&"object"==typeof t&&evaluateJSExpressions(e,t),e},handleServerMsg=function(e){e=evalJS(e);var t=$(e.ui);if(t)return t.removeClass(function(e,t){return(t.match(/(^|\s)jqui-interaction-\S+/g)||[]).join(" ")}),t=t.map(function(e,t){return t=getInputContainer(t),t=addWrapper(t),t=getWrapper(t)}),e.debug&&(console.log("==================="),console.log("ELEMENTS: "),console.log(t),console.log("MSG: "),console.log(e),console.log("===================")),{elements:t,type:e.type,func:e.func,operation:e.operation,options:e.options};console.warn("The selector didn't match any element. Operation abort.")},isHidden=function(e){return null!==e&&0===e.offsetWidth&&0===e.offsetHeight&&("none"===getStyle(e,"display")||isHidden(e.parentNode))},addJquiData=function(e){$(e).data("shinyjqui")||$(e).data("shinyjqui",{draggable:{save:{}},droppable:{save:{}},resizable:{save:{}},selectable:{save:{}},sortable:{save:{}}})},removeJquiData=function(e){var t=$(e);t.hasClass("jqui-wrapper")&&(t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable")||t.removeData("shinyjqui"))},addWrapper=function(e){if($(e).parent().hasClass("jqui-wrapper"))return e;if(!/action-button|html-widget-output|shiny-.+?-output/.test($(e).attr("class")))return e;var t=$("<div></div>").outerWidth($(e).outerWidth()?$(e).outerWidth():"100%").outerHeight($(e).outerHeight()?$(e).outerHeight():"100%").css($(e).css(["top","left"])).addClass("jqui-wrapper");return $(e).wrap(t).outerWidth("100%").outerHeight("100%").css({top:"0px",left:"0px"}).parent().get(0)},removeWrapper=function(e){var t=$(e);t.hasClass("jqui-wrapper")&&(t.hasClass("ui-draggable")||t.hasClass("ui-droppable")||t.hasClass("ui-selectable")||t.hasClass("ui-sortable")||t.hasClass("ui-resizable")||(t.children(".shiny-bound-output").outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).css(t.css(["top","left"])).insertAfter(t),t.remove()))},getWrapper=function(e){return $(e).parent().hasClass("jqui-wrapper")&&(e=$(e).parent().get(0)),e},addIndex=function(e){var t=$(e),a=shinyjqui.getId(e);if(t.hasClass("ui-sortable")&&a&&(t.find(".ui-sortable-handle").attr("jqui_sortable_idx",function(e,t){return a+"__"+(e+1)}),t.trigger("sortcreate")),t.hasClass("ui-draggable")&&t.draggable("option","connectToSortable")&&!t.is("[jqui_sortable_idx]")){var n=$(".ui-draggable").filter("[jqui_sortable_idx]").length;t.attr("jqui_sortable_idx",n+1)}t.hasClass("ui-selectable")&&a&&(t.find(".ui-selectee").attr("jqui_selectable_idx",function(e,t){return a+"__"+(e+1)}),t.trigger("selectablecreate"))},removeIndex=function(e){var t=$(e);t.hasClass("ui-selectable")||t.find(".ui-selectee").removeAttr("jqui_seletable_idx"),t.hasClass("ui-sortable")||t.find(".ui-sortable-handle").removeAttr("jqui_sortable_idx"),t.hasClass("ui-draggable")||t.removeAttr("jqui_sortable_idx")},interaction_settings={draggable:{getState:function(e){return $(e).offset()},setState:function(e,t){var a=$(e),n=new $.Event("mousedown",{pageX:a.offset().left,pageY:a.offset().top}),i=new $.Event("mouseup",{pageX:t.left,pageY:t.top});a.data("uiDraggable")._mouseStart(n),a.data("uiDraggable")._mouseDrag(i),a.data("uiDraggable")._mouseStop(i)},shiny:{_shinyjquiBookmarkState__draggable:{"dragcreate dragstop":function(e,t){return interaction_settings.draggable.getState(e.target)}},position:{"dragcreate drag dragstop":function(e,t){return $(e.target).position()}},is_dragging:{"dragcreate dragstop":function(e,t){return!1},dragstart:function(e,t){return!0}}}},droppable:{getState:function(e){},setState:function(e,t){},shiny:{over:{dropcreate:function(e,t){return[]},dropover:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},drop:{dropcreate:function(e,t){return[]},drop:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},out:{dropcreate:function(e,t){return[]},dropout:function(e,t){return shinyjqui.getId(t.draggable.get(0))}},dragging:{dropcreate:function(e,t){return[]},dropactivate:function(e,t){return shinyjqui.getId(t.draggable.get(0))},dropdeactivate:function(e,t){return[]}},dropped:{dropcreate:function(e,t){return $(e.target).data("shinyjqui_droppedIds",[]),[]},drop:function(e,t){var a=$(e.target).data("shinyjqui_droppedIds"),n=shinyjqui.getId(t.draggable.get(0));return-1==$.inArray(n,a)&&a.push(n),$(e.target).data("shinyjqui_droppedIds",a),a},dropout:function(e,t){var a=$(e.target).data("shinyjqui_droppedIds"),n=shinyjqui.getId(t.draggable.get(0));return a.splice($.inArray(n,a),1),$(e.target).data("shinyjqui_droppedIds",a),a}}}},resizable:{getState:function(e){return{width:$(e).width(),height:$(e).height()}},setState:function(e,t){var a=$(e),n=new $.Event("mousedown",{pageX:0,pageY:0}),i=new $.Event("mouseup",{pageX:t.width-a.width(),pageY:t.height-a.height()});a.data("uiResizable").axis="se",a.data("uiResizable")._mouseStart(n),a.data("uiResizable")._mouseDrag(i),a.data("uiResizable")._mouseStop(i)},shiny:{_shinyjquiBookmarkState__resizable:{"resizecreate resizestop":function(e,t){return interaction_settings.resizable.getState(e.target)}},size:{"resizecreate resize resizestop":function(e,t){return{width:$(e.target).width(),height:$(e.target).height()}}},is_resizing:{"resizecreate resizestop":function(e,t){return!1},resizestart:function(e,t){return!0}}}},selectable:{getState:function(e){var t=$(e).find(".ui-selected"),a=t.map(function(e,t){return $(t).attr("jqui_selectable_idx")}).get();return{selected:t,index:a}},setState:function(e,t){var a,n=$(e),i=n.selectable("option","classes.ui-selected");i=i?"ui-selected "+i:"ui-selected",t.selected instanceof jQuery?a=t.selected:(Array.isArray(t.index)||(t.index=Array(t.index)),a=$(t.index).map(function(e,t){return $("[jqui_selectable_idx="+t+"]").get(0)})),n.find(".ui-selected").not(a).removeClass(i).addClass("ui-unselecting"),a.not(".ui-selected").addClass("ui-selecting"),n.data("uiSelectable")._mouseStop(null)},shiny:{_shinyjquiBookmarkState__selectable:{"selectablecreate selectablestop":function(e,t){var a=interaction_settings.selectable.getState(e.target);return a.selected="",a}},"selected:shinyjqui.df":{"selectablecreate selectablestop":function(e,t){var a=$(e.target).find(".ui-selected"),n=a.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:a.map(function(e,t){return shinyjqui.getId(t)}).get(),text:n}}},is_selecting:{"selectablecreate selectablestop":function(e,t){return!1},selectablestart:function(e,t){return!0}}}},sortable:{getState:function(e){var t=$(e).find(".ui-sortable-handle,.ui-draggable"),a=t.map(function(e,t){return $(t).attr("jqui_sortable_idx")}).get();return{items:t,index:a}},setState:function(e,t){var a,n=$(e);t.items instanceof jQuery?a=t.items:(Array.isArray(t.index)||(t.index=Array(t.index)),a=$(t.index).map(function(e,t){return $("[jqui_sortable_idx="+t+"]").get(0)}));var i,r=n.find(".ui-sortable-handle"),s=r.length?r.parent():n;a.each(function(e,t){$(t).hasClass("ui-draggable")?$(t).clone().appendTo(s):(i=$(t).closest(".ui-sortable"),$(t).appendTo(s),i.is(n)||i.trigger("sortupdate"))}),n.trigger("sortupdate")},shiny:{_shinyjquiBookmarkState__sortable:{"sortcreate sortupdate":function(e,t){var a=interaction_settings.sortable.getState(e.target);return a.items="",a}},"order:shinyjqui.df":{"sortcreate sortupdate":function(e,t){var a=$(e.target).find(".ui-sortable-handle"),n=a.map(function(e,t){return t.innerText?t.innerText:""}).get();return{id:a.map(function(e,t){return shinyjqui.getId(t)}).get(),text:n}}}}}},interaction={enable:function(e,t,a){handleShinyInput(e,a,interaction_settings[t].shiny),$(e)[t](a),$(e)[t]("enable"),addJquiData(e),addIndex(e)},disable:function(e,t,a){handleShinyInput(e,a,interaction_settings[t].shiny),$(e)[t](a),$(e)[t]("disable")},destroy:function(e,t,a){var n=$(e);n.hasClass("ui-"+t)?(n[t]("destroy"),removeJquiData(e),removeWrapper(e),removeIndex(e)):console.warn("Interaction not initiated. Operation abort.")},save:function(e,t,a){var n=$(e);handleShinyInput(e,a,interaction_settings[t].shiny),n[t](a),n.data("shinyjqui")[t].save={option:n[t]("option"),state:interaction_settings[t].getState(e)}},load:function(e,t,a){var n=$(e);if(n.hasClass("ui-"+t)){var i=a||n.data("shinyjqui")[t].save;i?(i.option&&n[t]("option",i.option),i.state&&interaction_settings[t].setState(e,i.state)):console.warn("Nothing can be load. Operation abort.")}else console.warn("Interaction not initiated. Operation abort.")}};return{getId:function(e){var t=$(e).attr("id");return!t&&$(e).hasClass("tabbable")&&(t=$(e).find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".shiny-input-container").find(".shiny-bound-input").attr("id")),t||(t=$(e).closest(".shiny-bound-output").attr("id")),t||(t=$(e).closest(".jqui-wrapper").find(".shiny-bound-output").attr("id")),t||""},msgCallback:function(e){if(e=handleServerMsg(e)){var t=e.elements,a=e.type,n=e.operation,i=e.func,r=e.options;"interaction"===a?t.each(function(e,t){interaction[n](t,i,r)}):"effect"===a?t[i](r):"class"===a&&("add"===i||"remove"===i?t[i+"Class"](r.className,r):"switch"===i&&t.switchClass(r.removeClassName,r.addClassName,r))}},init:function(){Shiny.addCustomMessageHandler("shinyjqui",shinyjqui.msgCallback)}}}(),shinyjqui.init();
